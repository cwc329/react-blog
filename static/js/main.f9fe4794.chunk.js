(this["webpackJsonpreact-blog"]=this["webpackJsonpreact-blog"]||[]).push([[0],{34:function(t,e,n){},35:function(t,e,n){},43:function(t,e,n){"use strict";n.r(e);var r=n(1),a=n(0),c=n.n(a),i=n(25),u=n.n(i),s=(n(34),n(13)),o=n(2),l=n(7),j=n(4),b=n(3),d=(n(35),Object(a.createContext)(null));function h(){var t=Object(o.a)(["\n  font-weight: bold;\n"]);return h=function(){return t},t}function f(){var t=Object(o.a)(["\n  text-decoration: none;\n  color: black;\n\n  &:hover {\n    color: white;\n    background: black;\n  }\n"]);return f=function(){return t},t}function p(){var t=Object(o.a)(["\n  list-style-type: none;\n\n  & ~ & {\n    margin-left: 10px;\n  }\n"]);return p=function(){return t},t}function O(){var t=Object(o.a)(["\n  display: flex;\n"]);return O=function(){return t},t}function x(){var t=Object(o.a)(["\n  display: flex;\n  justify-content: space-between;\n  margin: 15px;\n"]);return x=function(){return t},t}var v=b.a.nav(x()),m=b.a.ul(O()),g=b.a.li(p()),y=Object(b.a)(l.b)(f()),w=b.a.span(h());function k(){var t=Object(j.f)(),e=Object(a.useContext)(d),n=e.user,c=e.setUser;return Object(r.jsxs)(v,{children:[Object(r.jsx)("h1",{children:Object(r.jsx)(y,{to:"/",children:"My blog"})}),Object(r.jsxs)(m,{children:[Object(r.jsx)(g,{children:Object(r.jsxs)(w,{children:[" ",n?"Hi~ ".concat(n.data.nickname):""]})}),Object(r.jsx)(g,{children:Object(r.jsx)(y,{to:"/posts",children:"\u6587\u7ae0\u5217\u8868"})}),n&&Object(r.jsx)(g,{children:Object(r.jsx)(y,{to:"/addpost",children:"\u65b0\u589e\u6587\u7ae0"})}),n&&Object(r.jsx)(g,{children:Object(r.jsx)(y,{to:"/",onClick:function(){window.localStorage.removeItem("token"),c(null),"/"!==t[t.length-1]&&t.push("/")},children:"\u767b\u51fa"})}),!n&&Object(r.jsx)(g,{children:Object(r.jsx)(y,{to:"/login",children:"\u767b\u5165"})}),!n&&Object(r.jsx)(g,{children:Object(r.jsx)(y,{to:"/register",children:"\u8a3b\u518a"})})]})]})}function C(t){var e=new Date(t);return e.toLocaleDateString("ch-TW")+" "+e.toLocaleTimeString("ch-TW")}var S=n(5),E=n.n(S),I=n(10),M="https://student-json-api.lidemy.me";function P(t){return q.apply(this,arguments)}function q(){return(q=Object(I.a)(E.a.mark((function t(e){var n,r,a,c,i;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(c in n=e.id,r=e.querystrings,a="".concat(M,"/posts"),n&&(a+="/".concat(n)),a+="?",r)a+="_".concat(c,"=").concat(r[c],"&");return a=a.slice(0,a.length-1),t.next=9,fetch(a);case 9:return i=t.sent,t.abrupt("return",i);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(t){return V.apply(this,arguments)}function V(){return(V=Object(I.a)(E.a.mark((function t(e){var n,r,a,c,i,u;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.token,r=e.data,a="".concat(M,"/posts"),c={method:"POST",headers:{authorization:"Bearer ".concat(n),"content-type":"application/json"},body:JSON.stringify(r)},t.next=5,fetch(a,c);case 5:return i=t.sent,t.next=8,i.json();case 8:return u=t.sent,t.abrupt("return",u);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function U(t){return B.apply(this,arguments)}function B(){return(B=Object(I.a)(E.a.mark((function t(e){var n,r,a,c,i,u;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.username,r=e.password,a="".concat(M,"/login"),c={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:n,password:r})},t.next=5,fetch(a,c);case 5:return i=t.sent,t.next=8,i.json();case 8:return u=t.sent,t.abrupt("return",u);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t){return F.apply(this,arguments)}function F(){return(F=Object(I.a)(E.a.mark((function t(e){var n,r,a,c,i;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.token){t.next=3;break}return t.abrupt("return",{});case 3:return r="".concat(M,"/me"),a={authorization:"Bearer ".concat(n)},t.next=8,fetch(r,{headers:a});case 8:return c=t.sent,t.next=11,c.json();case 11:return i=t.sent,t.abrupt("return",i);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function J(t){return L.apply(this,arguments)}function L(){return(L=Object(I.a)(E.a.mark((function t(e){var n,r,a,c,i,u,s;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.username,r=e.password,a=e.nickname,c="".concat(M,"/register"),i={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:n,password:r,nickname:a})},t.next=5,fetch(c,i);case 5:return u=t.sent,t.next=8,u.json();case 8:return s=t.sent,t.abrupt("return",s);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function N(){var t=Object(o.a)(["\n  display: inline-block;\n  text-decoration: none;\n  color: blue;\n  min-width: 15px;\n  text-align: center;\n  & ~ & {\n    margin-left: 5px;\n  }\n  &:hover {\n    background: #1111ff;\n    color: white;\n  }\n"]);return N=function(){return t},t}function A(){var t=Object(o.a)(["\n  margin: 0 auto;\n  text-align: center;\n"]);return A=function(){return t},t}function z(){var t=Object(o.a)(["\n  margin: 10px auto;\n  width: 450px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n"]);return z=function(){return t},t}var W=b.a.div(z()),H=b.a.div(A()),R=Object(b.a)(l.b)(N());function X(t){for(var e=t.currentPage,n=t.totalPages,a=[],c=e-2;c<=e+2;c++)a.push(c);return Object(r.jsxs)(W,{children:[e&&n&&Object(r.jsx)(H,{children:"".concat(e," / ").concat(n," page")}),Object(r.jsxs)("div",{children:[e>1?Object(r.jsx)(R,{to:"/posts?page=".concat(e-1),children:Object(r.jsx)("button",{children:"\u4e0a\u4e00\u9801"})}):"",a.filter((function(t){return t>0&&t<=n})).map((function(t){return Object(r.jsx)(R,{to:"/posts?page=".concat(t),children:t},t)})),e<n?Object(r.jsx)(R,{to:"/posts?page=".concat(e+1),children:Object(r.jsx)("button",{children:"\u4e0b\u4e00\u9801"})}):""]})]})}function _(){var t=Object(o.a)(["\n  text-decoration: none;\n  color: blue;\n"]);return _=function(){return t},t}function G(){var t=Object(o.a)(["\n  border: 1.5px solid black;\n  border-radius: 4px;\n  padding: 0 10px;\n\n  & ~ & {\n    margin-top: 5px;\n  }\n"]);return G=function(){return t},t}function K(){var t=Object(o.a)(["\n  width: 900px;\n  margin: 0 auto;\n"]);return K=function(){return t},t}var Q=b.a.div(K()),Y=b.a.div(G()),Z=Object(b.a)(l.b)(_());function $(t){var e=t.page,n=Object(a.useState)([]),c=Object(s.a)(n,2),i=c[0],u=c[1],o=Object(a.useState)(),l=Object(s.a)(o,2),j=l[0],b=l[1];return Object(a.useEffect)((function(){P({querystrings:{page:e,sort:"createdAt",order:"desc",limit:5}}).then((function(t){return b(Math.ceil(Number(t.headers.get("X-Total-Count"))/5)),t.json()})).then((function(t){u(t)}))}),[e]),Object(r.jsxs)(Q,{children:[i.map((function(t){return Object(r.jsxs)(Y,{children:[Object(r.jsx)("h1",{children:Object(r.jsx)(Z,{to:"posts/".concat(t.id),children:t.title})}),Object(r.jsx)("h4",{children:C(t.createdAt)})]},t.id)})),Object(r.jsx)(X,{currentPage:e,totalPages:j})]})}function tt(){var t=Object(o.a)(["\n  width: 900px;\n  margin: 0 auto;\n  border: 1.5px solid black;\n  border-radius: 4px;\n  padding: 0 10px;\n"]);return tt=function(){return t},t}var et=b.a.div(tt());function nt(){var t=Object(a.useState)({}),e=Object(s.a)(t,2),n=e[0],c=e[1],i=Object(j.h)().id;return Object(a.useEffect)((function(){P({id:i}).then((function(t){return t.json()})).then((function(t){c(t)}))}),[]),Object(r.jsxs)(et,{children:[Object(r.jsx)("h1",{children:n.title}),Object(r.jsx)("h4",{children:n.createdAt&&C(n.createdAt)}),Object(r.jsx)("p",{children:n.body})]})}function rt(){var t=Object(j.i)().path,e=new URLSearchParams(Object(j.g)().search);return Object(r.jsxs)(j.c,{children:[Object(r.jsx)(j.a,{exact:!0,path:t,children:Object(r.jsx)($,{page:Number(e.get("page"))||1})}),Object(r.jsx)(j.a,{path:"".concat(t,"/:id"),children:Object(r.jsx)(nt,{})})]})}var at=n(15),ct=n(12);function it(){var t=Object(a.useState)([]),e=Object(s.a)(t,2),n=e[0],r=e[1],c=Object(a.useState)(""),i=Object(s.a)(c,2),u=i[0],o=i[1],l=Object(a.useCallback)((function(t,e){r(n.map((function(n){return n.attributes.name!==t?n:Object(ct.a)(Object(ct.a)({},n),{},{errorMessage:e})})))}),[r,n]),j=Object(a.useCallback)((function(t,e){r(n.map((function(n){return t!==n.attributes.name?n:Object(ct.a)(Object(ct.a)({},n),{},{attributes:Object(ct.a)(Object(ct.a)({},n.attributes),{},{value:e})})})))}),[r,n]);return{errorMessage:u,setErrorMessage:o,inputs:n,setInputs:r,handleChange:j,handleValidationCheck:l}}function ut(){var t=Object(o.a)(["\n  width: 100%;\n  height: 300px;\n"]);return ut=function(){return t},t}function st(){var t=Object(o.a)(["\n  width: 100%;\n  height: 2rem;\n  font-size: 1.5rem;\n"]);return st=function(){return t},t}function ot(){var t=Object(o.a)(["\n  width: 100%;\n  & ~ & {\n    margin-top: 10px;\n  }\n"]);return ot=function(){return t},t}var lt=b.a.div(ot()),jt=b.a.input(st()),bt=b.a.textarea(ut());function dt(t){var e=t.input,n=t.handleChange,a=t.handleValidationCheck,c=e.attributes,i=function(t){n(e.attributes.name,t.target.value)},u=function(t){a(e.attributes.name,t.target.validationMessage)};return Object(r.jsxs)(lt,{children:[Object(r.jsx)("label",{htmlFor:c.name,children:e.title?Object(r.jsx)("h3",{children:e.title}):""}),Object(r.jsx)("div",{children:"textarea"!==e.attributes.type?Object(r.jsx)(jt,Object(ct.a)(Object(ct.a)({},c),{},{onChange:i,onBlur:u,onInvalid:u})):Object(r.jsx)(bt,Object(ct.a)(Object(ct.a)({},c),{},{onChange:i,onBlur:u,onInvalid:u}))})]})}function ht(){var t=Object(o.a)(["\n  margin: 0 auto;\n  width: 200px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]);return ht=function(){return t},t}var ft=b.a.form(ht());function pt(){var t=it(),e=t.errorMessage,n=t.setErrorMessage,c=t.inputs,i=t.setInputs,u=t.handleChange,s=t.handleValidationCheck,o=Object(j.f)(),l=Object(a.useContext)(d),b=l.user,h=l.setUser;Object(a.useEffect)((function(){i([{attributes:{type:"text",name:"username",value:"",required:!0},title:"\u5e33\u865f"},{attributes:{type:"text",name:"nickname",value:"",required:!0},title:"\u66b1\u7a31"},{attributes:{type:"password",name:"password",value:"",required:!0},title:"\u5bc6\u78bc"},{attributes:{type:"submit",name:"submit",value:"\u8a3b\u518a"},title:""}])}),[i]),Object(a.useEffect)((function(){b&&o.push("/")}),[]);var f=function(){var t=Object(I.a)(E.a.mark((function t(e){var r,a,i,u,s;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),r=["username","password","nickname"],a={},c.forEach((function(t){var e,n=Object(at.a)(r);try{for(n.s();!(e=n.n()).done;){var c=e.value;c===t.attributes.name&&(a[c]=t.attributes.value)}}catch(i){n.e(i)}finally{n.f()}})),t.prev=4,t.next=7,J(a);case 7:if(i=t.sent,u=i.ok,s=i.token,1===u){t.next=12;break}return n(i.message),t.abrupt("return");case 12:window.localStorage.setItem("token",i.token),D({token:s}).then((function(t){h(t)})),o.push("/"),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(4),alert(t.t0);case 20:case"end":return t.stop()}}),t,null,[[4,17]])})));return function(e){return t.apply(this,arguments)}}();return Object(r.jsxs)("div",{children:[Object(r.jsx)(ft,{onSubmit:f,children:c.map((function(t){return Object(r.jsx)(dt,{input:t,handleChange:u,handleValidationCheck:s},t.attributes.name)}))}),Object(r.jsx)("div",{children:Object(r.jsx)("p",{children:e})})]})}function Ot(){var t=Object(o.a)(["\n  margin: 0 auto;\n  width: 200px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]);return Ot=function(){return t},t}var xt=b.a.form(Ot());function vt(){var t=it(),e=t.errorMessage,n=t.setErrorMessage,c=t.inputs,i=t.setInputs,u=t.handleChange,s=t.handleValidationCheck,o=Object(j.f)(),l=Object(a.useContext)(d),b=l.user,h=l.setUser;Object(a.useEffect)((function(){i([{attributes:{type:"text",name:"username",value:"",required:!0},title:"\u5e33\u865f"},{attributes:{type:"password",name:"password",value:"",required:!0},title:"\u5bc6\u78bc"},{attributes:{type:"submit",name:"submit",value:"\u767b\u5165"},title:""}])}),[i]),Object(a.useEffect)((function(){b&&o.push("/")}),[]);var f=function(){var t=Object(I.a)(E.a.mark((function t(e){var r,a,i,u,s,l;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),r=["username","password"],a={},c.forEach((function(t){var e,n=Object(at.a)(r);try{for(n.s();!(e=n.n()).done;){var c=e.value;c===t.attributes.name&&(a[c]=t.attributes.value)}}catch(i){n.e(i)}finally{n.f()}})),t.prev=4,t.next=7,U(a);case 7:if(i=t.sent,u=i.ok,s=i.message,l=i.token,1===u){t.next=12;break}return n(s),t.abrupt("return");case 12:window.localStorage.removeItem("token"),window.localStorage.setItem("token",l),D({token:l}).then((function(t){h(t)})),o.push("/"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(4),alert(t.t0);case 21:case"end":return t.stop()}}),t,null,[[4,18]])})));return function(e){return t.apply(this,arguments)}}();return Object(r.jsxs)("div",{children:[Object(r.jsx)(xt,{onSubmit:f,children:c.map((function(t){return Object(r.jsx)(dt,{input:t,handleChange:u,handleValidationCheck:s},t.attributes.name)}))}),Object(r.jsx)("div",{children:Object(r.jsx)("p",{children:e})})]})}function mt(){return Object(r.jsx)($,{})}function gt(){var t=Object(o.a)(["\n  width: 900px;\n"]);return gt=function(){return t},t}function yt(){var t=Object(o.a)(["\n  margin: 0 auto;\n  width: 900px;\n"]);return yt=function(){return t},t}var wt=b.a.form(yt()),kt=Object(b.a)(dt)(gt());function Ct(){var t=function(){var t=Object(j.f)(),e=Object(a.useContext)(d),n=e.user,r=e.setUser;return Object(a.useEffect)((function(){n||t.push("/")}),[]),{user:n,setUser:r,history:t}}().history,e=it(),n=e.errorMessage,c=e.inputs,i=e.setInputs,u=e.handleChange,s=e.handleValidationCheck;Object(a.useEffect)((function(){i([{attributes:{type:"text",name:"title",value:"",required:!0},title:"\u6a19\u984c"},{attributes:{type:"textarea",name:"body",value:"",required:!0},title:"\u5167\u6587"},{attributes:{type:"submit",name:"submit",value:"\u767c\u5e03"},title:""}])}),[i]);var o=function(){var e=Object(I.a)(E.a.mark((function e(n){var r,a,i;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r=window.localStorage.getItem("token"),a=["title","body"],i={},c.forEach((function(t){var e,n=t.attributes,r=n.name,c=n.value,u=Object(at.a)(a);try{for(u.s();!(e=u.n()).done;){var s=e.value;s===r&&(i[s]=c)}}catch(o){u.e(o)}finally{u.f()}})),e.next=7,T({token:r,data:i});case 7:t.push("/");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{children:[Object(r.jsx)(wt,{onSubmit:o,children:c.map((function(t){return Object(r.jsx)(kt,{input:t,handleChange:u,handleValidationCheck:s},t.attributes.name)}))}),Object(r.jsx)("div",{children:Object(r.jsx)("p",{children:n})})]})}function St(){var t=Object(o.a)(["\n  max-width: 1920px;\n  margin: 0 auto;\n\n\n"]);return St=function(){return t},t}var Et=b.a.div(St());var It=function(){var t=Object(a.useState)(null),e=Object(s.a)(t,2),n=e[0],c=e[1];return Object(a.useEffect)((function(){D({token:window.localStorage.getItem("token")}).then((function(t){if(1!==t.ok)window.localStorage.setItem("token",""),c(null);else{if(n&&t.data.id===n.data.id)return;c(t)}}))}),[n]),Object(r.jsx)(Et,{children:Object(r.jsx)(d.Provider,{value:{user:n,setUser:c},children:Object(r.jsxs)(l.a,{children:[Object(r.jsx)(k,{}),Object(r.jsxs)(j.c,{children:[Object(r.jsx)(j.a,{exact:!0,path:"/",children:Object(r.jsx)(mt,{})}),Object(r.jsx)(j.a,{path:"/login",children:Object(r.jsx)(vt,{})}),Object(r.jsx)(j.a,{path:"/posts",children:Object(r.jsx)(rt,{})}),Object(r.jsx)(j.a,{path:"/register",children:Object(r.jsx)(pt,{})}),Object(r.jsx)(j.a,{path:"/addPost",children:Object(r.jsx)(Ct,{})})]})]})})})},Mt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,44)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,i=e.getTTFB;n(t),r(t),a(t),c(t),i(t)}))};u.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(It,{})}),document.getElementById("root")),Mt()}},[[43,1,2]]]);
//# sourceMappingURL=main.f9fe4794.chunk.js.map